{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Shitote\\\\OneDrive\\\\Desktop\\\\test\\\\testing-and-debugging-ensuring-mern-app-reliability-Ezra254\\\\client\\\\src\\\\context\\\\AuthContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport { useLocalStorage } from '../hooks/useLocalStorage';\nimport { loginUser, registerUser, fetchCurrentUser } from '../services/authService';\nimport { setAuthToken } from '../services/apiClient';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [authState, setAuthState] = useLocalStorage('mern-auth', {\n    user: null,\n    token: null\n  });\n  const login = useCallback(async credentials => {\n    const data = await loginUser(credentials);\n    setAuthState({\n      user: data.user,\n      token: data.token\n    });\n    return data;\n  }, [setAuthState]);\n  const register = useCallback(async payload => {\n    const data = await registerUser(payload);\n    setAuthState({\n      user: data.user,\n      token: data.token\n    });\n    return data;\n  }, [setAuthState]);\n  const logout = useCallback(() => {\n    setAuthState({\n      user: null,\n      token: null\n    });\n  }, [setAuthState]);\n  useEffect(() => {\n    setAuthToken(authState === null || authState === void 0 ? void 0 : authState.token);\n  }, [authState === null || authState === void 0 ? void 0 : authState.token]);\n  useEffect(() => {\n    if (authState !== null && authState !== void 0 && authState.token && !(authState !== null && authState !== void 0 && authState.user)) {\n      fetchCurrentUser().then(data => {\n        setAuthState(prev => ({\n          ...prev,\n          user: data.user\n        }));\n      }).catch(() => {\n        logout();\n      });\n    }\n  }, [authState === null || authState === void 0 ? void 0 : authState.token, authState === null || authState === void 0 ? void 0 : authState.user, logout, setAuthState]);\n  const refreshSession = useCallback(async () => {\n    if (!(authState !== null && authState !== void 0 && authState.token)) return null;\n    try {\n      const data = await fetchCurrentUser();\n      setAuthState(prev => ({\n        ...prev,\n        user: data.user\n      }));\n      return data;\n    } catch (error) {\n      logout();\n      return null;\n    }\n  }, [authState === null || authState === void 0 ? void 0 : authState.token, logout, setAuthState]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user: authState === null || authState === void 0 ? void 0 : authState.user,\n      token: authState === null || authState === void 0 ? void 0 : authState.token,\n      login,\n      register,\n      logout,\n      refreshSession,\n      isAuthenticated: Boolean(authState === null || authState === void 0 ? void 0 : authState.token)\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"tVHCcPvu/1lUOiag7MQrjsbap2A=\", false, function () {\n  return [useLocalStorage];\n});\n_c = AuthProvider;\nAuthProvider.propTypes = {\n  children: PropTypes.node.isRequired\n};\nexport const useAuth = () => {\n  _s2();\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n_s2(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useCallback","PropTypes","useLocalStorage","loginUser","registerUser","fetchCurrentUser","setAuthToken","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","authState","setAuthState","user","token","login","credentials","data","register","payload","logout","then","prev","catch","refreshSession","error","Provider","value","isAuthenticated","Boolean","fileName","_jsxFileName","lineNumber","columnNumber","_c","propTypes","node","isRequired","useAuth","_s2","context","Error","$RefreshReg$"],"sources":["C:/Users/Shitote/OneDrive/Desktop/test/testing-and-debugging-ensuring-mern-app-reliability-Ezra254/client/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useLocalStorage } from '../hooks/useLocalStorage';\r\nimport { loginUser, registerUser, fetchCurrentUser } from '../services/authService';\r\nimport { setAuthToken } from '../services/apiClient';\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [authState, setAuthState] = useLocalStorage('mern-auth', {\r\n    user: null,\r\n    token: null,\r\n  });\r\n\r\n  const login = useCallback(async (credentials) => {\r\n    const data = await loginUser(credentials);\r\n    setAuthState({\r\n      user: data.user,\r\n      token: data.token,\r\n    });\r\n    return data;\r\n  }, [setAuthState]);\r\n\r\n  const register = useCallback(async (payload) => {\r\n    const data = await registerUser(payload);\r\n    setAuthState({\r\n      user: data.user,\r\n      token: data.token,\r\n    });\r\n    return data;\r\n  }, [setAuthState]);\r\n\r\n  const logout = useCallback(() => {\r\n    setAuthState({ user: null, token: null });\r\n  }, [setAuthState]);\r\n\r\n  useEffect(() => {\r\n    setAuthToken(authState?.token);\r\n  }, [authState?.token]);\r\n\r\n  useEffect(() => {\r\n    if (authState?.token && !authState?.user) {\r\n      fetchCurrentUser()\r\n        .then((data) => {\r\n          setAuthState((prev) => ({\r\n            ...prev,\r\n            user: data.user,\r\n          }));\r\n        })\r\n        .catch(() => {\r\n          logout();\r\n        });\r\n    }\r\n  }, [authState?.token, authState?.user, logout, setAuthState]);\r\n\r\n  const refreshSession = useCallback(async () => {\r\n    if (!authState?.token) return null;\r\n    try {\r\n      const data = await fetchCurrentUser();\r\n      setAuthState((prev) => ({\r\n        ...prev,\r\n        user: data.user,\r\n      }));\r\n      return data;\r\n    } catch (error) {\r\n      logout();\r\n      return null;\r\n    }\r\n  }, [authState?.token, logout, setAuthState]);\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user: authState?.user,\r\n        token: authState?.token,\r\n        login,\r\n        register,\r\n        logout,\r\n        refreshSession,\r\n        isAuthenticated: Boolean(authState?.token),\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nAuthProvider.propTypes = {\r\n  children: PropTypes.node.isRequired,\r\n};\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport default AuthContext;\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}